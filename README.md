# Nextflow microbeannotator pipeline

Pipeline and wrapper around using microbeannotator to compute pathway presence/absence in metagenomes or metatranscriptomes.

## Introduction

Chiamh/meta-microbeannotator-nf is pipeline that extracts protein sequences from a set of metagenome/metatranscriptome annotations generated by Chiamh/meta-omics-nf (optional) \
and performs pathway completeness analysis using [microbeannotator v2.1.5](https://github.com/cruizperez/MicrobeAnnotator)

The pipeline is built using [Nextflow DSL2](https://www.nextflow.io/docs/latest/dsl2.html) , a workflow tool to run tasks across multiple compute infrastructures in a very portable manner. 
It uses Docker containers (also compatible with Singularity) for ease of installation and computational reproducibility. 

## Input requirements
Either:
1. Absolute path to the **folder** containing the \*_merged_panalign_annot.tsv AND \*_merged_transl-search_annot.tsv specified with the --mgx_annotations and/or --mtx_annotations arguments. 
* This will search the folder(s) recursively for the [annotation files](https://github.com/Chiamh/meta-omics-nf/blob/main/README.md) and run the pipeline on all of them.  
or:  
2. Absolute path to the **folder** containing fasta files with protein sequences translated from ORFs found in metagenomes/metatranscriptomes using the -mgx_protein_seqs and/or -mtx_protein_seqs.
* These inputs are strictly for the "annotate" but not the "full" workflow!

## Quick Start

1. Install [`Nextflow`](https://www.nextflow.io/docs/latest/getstarted.html#installation) (`>=21.04.0`) and add the nextflow executable to your $PATH

2. Install [`Docker`](https://docs.docker.com/engine/installation/)   

3. Clone the pipeline and refer to the help message
	```
	git clone https://github.com/Chiamh/meta-microbeannotator-nf
	
	nextflow run ./alignment-nf/meta-microbeannotator-nf --help
	```
* Add a custom config file which contains the paths to various pre-installed databases. Refer to the awsbatch.config file in this repo for an example. 
* Add a custom profile in the nextflow.config file, allowing you to specify the use of docker or singularity, and/or a task scheduler.  

4. Make sure all helper scripts in alignment-nf/bin have execute permissions

	```
	chmod +x ./meta-microbeannotator-nf/bin/*
	```

5. (A): Run the pipeline (full workflow)

	```
	nextflow run ./meta-microbeannotator-nf/main.nf -profile docker,your_profile --mtx_annotations /path/to/mtx_annotations --mgx_annotations /path/to/mgx_annotations --outdir /path/to/results
	
	
	```

* You can specify multiple profiles separated by comma, e.g. -profile docker,sge.
* Delete the work/ directory after running the pipeline to free up space taken up by intermediate files
* If using awsbatch, you need to specify an S3 bucket as a work directory with the -bucket-dir argument


OR


5. (B): Run the pipeline with only microbeannotator, on protein fasta files. (annotate workflow)

	```
	nextflow run ./meta-microbeannotator-nf/main.nf -profile docker,your_profile -entry annotate --mtx_annotations /path/to/mtx_protein_fastas --mgx_annotations /path/to/mgx_protein_fastas --outdir /path/to/results


	```

## Contact

Minghao Chia: chia_minghao@gis.a-star.edu.sg, chiaminghao@gmail.com
